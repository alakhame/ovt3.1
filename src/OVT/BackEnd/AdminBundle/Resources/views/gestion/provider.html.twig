{% extends "OVTBackEndAdminBundle:SuperAdmin:profil.html.twig" %}
{% block links %}
	{{parent()}}
	<link rel="stylesheet" href="{{asset('ress/css/gestion.css')}}" /> 
	<script src="{{asset('ress/js/angular.js')}}" > </script>
	<script src="{{asset('ress/js/jquery.js')}}" > </script>
	<script src="{{ asset('bundles/fosjsrouting/js/router.js') }}"></script>
	<script src="{{ path('fos_js_routing_js', {"callback": "fos.Router.setData"}) }}"></script>

{% endblock %}
	{% block container %}

		<div id="cadre"  ng-app="OVTApp" ng-controller="providerCtrl">
			<div id="gestion_title">
				<p  >Gestion des Prestataires </p>
				<div class=""  style="float:right;margin-right:50px" >
						<a href="{{path('ovt_back_end_admin_gestion_new',{gestion:'adminProvider'})}}">
							<img width="16px" height="16px"  src="{{asset('ress/img/add.png')}}">
							Nouveau Administrateur Prestaire
						</a>
				</div>
			</div>
			<div id="inside_cadre">
				<div class="list">
					<div class="list_border">
						<div class="entete">
							<label for="tri"> Trier Par : </label>
							<select name="choix_tri" > 
							</select>
						</div>

						<br/>

						<div class="user_list">
							{{render(controller('OVTBackEndAdminBundle:OrganisationAdmin:getOrganisationsByType',{type:'provider',action:'reload'}))}}
						</div>
					</div>

					<div class="new_user"  >
						<a href="{{path('ovt_back_end_admin_gestion_new',{gestion:'provider'})}}">
							<img width="16px" height="16px"  src="{{asset('ress/img/add.png')}}">
							Nouveau
						</a>
					</div>

				</div>

				<div class="infos">
					<div class="user_infos">
						<div class="user_infos_border" style="float:left">
							<img src="{{asset('ress/img/loader.gif')}}" ng-show="loading" id="loader">
							<div  ng-hide="loading  " id="clientInfo" >
								<div ng-show="angular.isDefined(selectedProvider)">

								</div>
								{% verbatim %}
								<div>
									<h5> Nom  : </h5>
									<p>{{selectedProvider.name}}</p>
								</div>

								<div>
									<h5> Adresse : </h5>
									<p>{{selectedProvider.address}}</p>
								</div>
								<div>
									<h5> Téléphone : </h5>
									<p>{{selectedProvider.phoneNumber}}</p>
								</div>
								<div>
									<h5> Lien Connexion : </h5>
									<p>BASE_SERVER/client/{{selectedProvider.hashLink}}/login</p>
								</div>
								<div>
									<h5> Administrateurs : </h5>
									<p ng-repeat="a in selectedProvider.admins" > 
										{{a.admin}} 
										<a href="#" ng-click="delAdmin(selectedProvider.id,a.id)"  > X</a>

									</p>
								</div>
								<div>
									<h5> Services offerts : </h5>
									<p ng-repeat="s in selectedProvider.services" > 
										{{s.name}} 
									</p>
								</div>
								{% endverbatim %}
							</div>
						</div>
						<div  ng-hide="loading">
							<input  class="submitButtton" ng-click="switchAffect()" value="Affecter Administrateur"></input>
							 <form ng-show="affectShow" method='post' action="{{path('ovt_back_end_admin_gestion_organisation_setadmin',{org:'provider'})}}">
								<select name="admin">
									{{ render(controller('OVTBackEndAdminBundle:UserAdmin:listAdmins',{type:'provider'})) }}
								</select>
								<input type="hidden" name="idOrg"   value="{% verbatim %}{{selectedProvider.id}}{% endverbatim %}"></input>
								<input type="hidden" name="org"   value="provider"></input>
								<input  class="submitButtton" type="submit" value="Soumettre"></input>
							</form>
						</div>
						<br/><br/>
						<div    ng-hide="loading">
							<input ng-click="toUpdate(selectedProvider.id)"  class="submitButtton" value="Modifier"></input>
						</div>
						<br/><br/>
						<div    ng-hide="loading">
							<input ng-click="deleteOrg(selectedProvider.id)"  class="submitButtton" value="Supprimer"></input>
						</div>
						<br/><br/>
						<div    ng-hide="loading">
							<input  ng-click="manageServices(selectedProvider.id)"  class="submitButtton" value="Gerer les services"></input>
						</div>
					</div>
					
					
			</div>

				<script  >	   

				var app = angular.module('OVTApp', []);
				
				app.controller('providerCtrl', function($scope,$http,$location,$window) {
						$scope.affectShow=false;
						$scope.loading = false;
						$scope.actionClick= function (idprovider) {
						
							$scope.loading = true;
				   			{% verbatim %} var link=Routing.generate('ovt_back_end_admin_gestion_get_organisation_by_id', {id:idprovider,organisation:'provider'}); {% endverbatim %}
				   			$http.get(link).
						  	success(function(data, status, headers, config) {
							    $scope.selectedProvider=data;
							    $scope.loading = false;

						  	}).
						 	error(function(data, status, headers, config) { });
				   		}

				   		$scope.switchAffect = function (){
				   			$scope.affectShow=!($scope.affectShow);
				   		}

				   		$scope.delAdmin= function (idorg,idadmin) {
							$scope.loading = true;
				   			{% verbatim %} var link=Routing.generate('ovt_back_end_admin_gestion_organisation_deleteadmin', {idOrg:idorg,idAdmin:idadmin,org:'provider'}); {% endverbatim %}
				   			$http.get(link).
						  	success(function(data, status, headers, config) {
							    $scope.loading = false;
						 		$window.location.href=Routing.generate('ovt_back_end_admin_gestion',{gestion:'provider'});
						  	}).
						 	error(function(data, status, headers, config) { });
				   		}
						$scope.toUpdate= function (idorg) {
							{% verbatim %} var link=Routing.generate('ovt_back_end_admin_gestion_organisation_update', {idOrg:idorg,org:'provider'}); {% endverbatim %}
							$window.location.href=link;
				   		}
				   		$scope.deleteOrg= function (idorg) {
							{% verbatim %} var link=Routing.generate('ovt_back_end_admin_gestion_organisation_delete', {idOrg:idorg,org:'provider'}); {% endverbatim %}
							$scope.loading = true;
							var confirmation = confirm("Voulez vraiment supprimer cette organisation ?");
							if(confirmation){
								$window.location.href=link;
							}else {
								$scope.loading = false;
							}
				   		}
				   		$scope.manageServices= function (idorg) {
							{% verbatim %} var link=Routing.generate('ovt_back_end_admin_manage_service', {idOrg:idorg,organisation:'provider'}); {% endverbatim %}
								$window.location.href=link;
							
				   		}
				   	});

			</script>

		</div>
	

	{% endblock %} 